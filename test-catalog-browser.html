<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Catalog Browser - Test</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
  <div class="max-w-7xl mx-auto p-8">
    <div class="bg-white rounded-lg shadow-lg p-8 mb-8">
      <h1 class="text-3xl font-bold text-gray-900 mb-2">üìö Recipe Catalog Browser</h1>
      <p class="text-gray-600 mb-6">Testing Slice 5 catalog with health scores and local images</p>
      
      <div class="grid grid-cols-3 gap-4 mb-6 text-center">
        <div class="bg-blue-50 p-4 rounded-lg">
          <div class="text-3xl font-bold text-blue-600" id="recipeCount">--</div>
          <div class="text-sm text-gray-600">Total Recipes</div>
        </div>
        <div class="bg-green-50 p-4 rounded-lg">
          <div class="text-3xl font-bold text-green-600" id="scoredCount">--</div>
          <div class="text-sm text-gray-600">With Health Scores</div>
        </div>
        <div class="bg-purple-50 p-4 rounded-lg">
          <div class="text-3xl font-bold text-purple-600" id="avgScore">--</div>
          <div class="text-sm text-gray-600">Avg Health Score</div>
        </div>
      </div>

      <div class="flex gap-4 mb-6">
        <select id="cuisineFilter" class="border border-gray-300 rounded-lg px-4 py-2">
          <option value="">All Cuisines</option>
        </select>
        <select id="dietFilter" class="border border-gray-300 rounded-lg px-4 py-2">
          <option value="">All Diets</option>
        </select>
        <button id="loadBtn" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">
          Load Catalog
        </button>
      </div>
    </div>

    <div id="recipeGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      <!-- Recipes will load here -->
    </div>
  </div>

  <script type="module">
    let catalog = null;

    async function loadCatalog() {
      const btn = document.getElementById('loadBtn');
      btn.disabled = true;
      btn.textContent = 'Loading...';

      try {
        const response = await fetch('/src/data/vanessa_recipe_catalog.json');
        const data = await response.json();
        catalog = data.recipes || [];
        
        document.getElementById('recipeCount').textContent = catalog.length;
        document.getElementById('scoredCount').textContent = catalog.filter(r => r.dietCompassScores).length;
        
        const avgScore = catalog
          .filter(r => r.dietCompassScores)
          .reduce((sum, r) => sum + r.dietCompassScores.overall, 0) / catalog.filter(r => r.dietCompassScores).length;
        document.getElementById('avgScore').textContent = avgScore.toFixed(1);

        // Populate filters
        const cuisines = [...new Set(catalog.flatMap(r => r.tags?.cuisines || []))].sort();
        const diets = [...new Set(catalog.flatMap(r => r.tags?.diets || []))].sort();
        
        const cuisineFilter = document.getElementById('cuisineFilter');
        cuisines.forEach(c => {
          const option = document.createElement('option');
          option.value = c;
          option.textContent = c.charAt(0).toUpperCase() + c.slice(1);
          cuisineFilter.appendChild(option);
        });

        const dietFilter = document.getElementById('dietFilter');
        diets.forEach(d => {
          const option = document.createElement('option');
          option.value = d;
          option.textContent = d.replace(/_/g, ' ').split(' ').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');
          dietFilter.appendChild(option);
        });

        displayRecipes(catalog);
        btn.textContent = '‚úÖ Loaded';
        
      } catch (error) {
        console.error('Error loading catalog:', error);
        btn.textContent = '‚ùå Error';
      }
    }

    function displayRecipes(recipes) {
      const grid = document.getElementById('recipeGrid');
      grid.innerHTML = '';

      recipes.slice(0, 50).forEach(recipe => {
        const card = createRecipeCard(recipe);
        grid.appendChild(card);
      });

      if (recipes.length > 50) {
        grid.innerHTML += `<div class="col-span-full text-center text-gray-500">Showing first 50 of ${recipes.length} recipes</div>`;
      }
    }

    function createRecipeCard(recipe) {
      const card = document.createElement('div');
      card.className = 'bg-white rounded-lg shadow hover:shadow-lg transition-shadow overflow-hidden';

      const scores = recipe.dietCompassScores;
      const hasScores = !!scores;

      card.innerHTML = `
        <div class="aspect-video bg-gray-100 flex items-center justify-center overflow-hidden">
          ${recipe.image ? `
            <img src="${recipe.image}" alt="${recipe.name}" class="w-full h-full object-cover" onerror="this.parentElement.innerHTML='<span class=\\'text-gray-400\\'>No image</span>'">
          ` : `
            <span class="text-gray-400">No image</span>
          `}
        </div>
        
        <div class="p-4">
          <h3 class="font-semibold text-gray-900 mb-2 line-clamp-2">${recipe.name}</h3>
          
          ${hasScores ? `
            <div class="flex flex-wrap gap-2 mb-3">
              <div class="flex items-center gap-1">
                <span>ü•ó</span>
                ${renderMiniBar(scores.nutrientDensity)}
              </div>
              <div class="flex items-center gap-1">
                <span>‚è≥</span>
                ${renderMiniBar(scores.antiAging)}
              </div>
              <div class="flex items-center gap-1">
                <span>‚öñÔ∏è</span>
                ${renderMiniBar(scores.weightLoss)}
              </div>
              <div class="flex items-center gap-1">
                <span>‚ù§Ô∏è</span>
                ${renderMiniBar(scores.heartHealth)}
              </div>
            </div>
            
            <div class="flex items-center gap-2 mb-3">
              <span class="text-xs text-gray-500">Overall:</span>
              <span class="text-lg font-bold ${scores.overall >= 60 ? 'text-green-600' : scores.overall >= 40 ? 'text-yellow-600' : 'text-gray-500'}">${scores.overall}</span>
              <span class="text-xs px-2 py-0.5 rounded ${
                scores.overall >= 80 ? 'bg-green-100 text-green-800' :
                scores.overall >= 60 ? 'bg-green-50 text-green-700' :
                scores.overall >= 40 ? 'bg-yellow-100 text-yellow-800' :
                'bg-orange-100 text-orange-800'
              }">
                ${scores.overall >= 80 ? 'Excellent' : scores.overall >= 60 ? 'Good' : scores.overall >= 40 ? 'Moderate' : 'Fair'}
              </span>
            </div>
          ` : `
            <div class="text-xs text-gray-400 mb-3">No health scores</div>
          `}
          
          <div class="flex items-center gap-4 text-xs text-gray-500">
            <span>‚è±Ô∏è ${recipe.prepTime + recipe.cookTime} min</span>
            <span>üçΩÔ∏è ${recipe.servings} servings</span>
          </div>
          
          ${recipe.tags?.diets?.length > 0 ? `
            <div class="mt-2 flex flex-wrap gap-1">
              ${recipe.tags.diets.slice(0, 3).map(d => `
                <span class="text-xs px-2 py-1 bg-gray-100 text-gray-700 rounded">${d}</span>
              `).join('')}
            </div>
          ` : ''}
        </div>
      `;

      return card;
    }

    function renderMiniBar(score) {
      const segments = score >= 80 ? 5 : score >= 60 ? 4 : score >= 40 ? 3 : score >= 20 ? 2 : 1;
      const color = score >= 60 ? 'bg-green-500' : score >= 40 ? 'bg-yellow-500' : 'bg-gray-400';
      
      let html = '<div class="flex gap-0.5">';
      for (let i = 1; i <= 5; i++) {
        html += `<div class="w-1.5 h-3 rounded-sm ${i <= segments ? color : 'bg-gray-200'}"></div>`;
      }
      html += '</div>';
      return html;
    }

    // Filter handlers
    document.getElementById('cuisineFilter').addEventListener('change', (e) => {
      if (!catalog) return;
      const cuisine = e.target.value;
      const filtered = cuisine 
        ? catalog.filter(r => r.tags?.cuisines?.includes(cuisine.toLowerCase()))
        : catalog;
      displayRecipes(filtered);
    });

    document.getElementById('dietFilter').addEventListener('change', (e) => {
      if (!catalog) return;
      const diet = e.target.value;
      const filtered = diet
        ? catalog.filter(r => r.tags?.diets?.includes(diet.toLowerCase()))
        : catalog;
      displayRecipes(filtered);
    });

    document.getElementById('loadBtn').addEventListener('click', loadCatalog);
  </script>
</body>
</html>
